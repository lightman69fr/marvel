var Personnages=function(e){var a=configKeys.public_key,r=(new Date).getTime(),t=md5(r+configKeys.private_key+configKeys.public_key),i="liste";switch(this.PUBLIC_KEY=a,this.hash=t,this.ts=r,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(i=e.mode),i){default:this.getListPersonnages();break;case"liste":if(isDefined(e)&&e.hasOwnProperty("paramsListe"))var s=e.paramsListe;else var s=void 0;this.getListPersonnages(s);break;case"showPers":if(e.hasOwnProperty("persID")){var n=parseInt(e.persID);this.getPersonnage(n)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var a=this,r=a.PUBLIC_KEY,t=a.hash,i=a.ts,s={offset:0,limit:100,orderBy:"onsaleDate"},n=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+i+"&apikey="+r+"&hash="+t+"&"+n,l="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+i+"&apikey="+r+"&hash="+t,v="GET",p=null,h=null,f={page:l,methode:v,callback:function(e){var r=JSON.parse(e);p=r;var t={page:o,methode:v,callback:function(e){var r=JSON.parse(e);h=r,console.log(h),a.showPersonnage(p,h)}};new AjaxHome(t)}};new AjaxHome(f)},showPersonnage:function(e,a){if(e.hasOwnProperty("data")){var r=e.data;if(r.hasOwnProperty("results")){var t=r.results[0],i=null,s=null,n="",o=null;t.hasOwnProperty("id")&&(i=t.id.toString()),t.hasOwnProperty("name")&&(s=t.name),t.hasOwnProperty("description")&&sizeOf(t.description)>0&&(n=t.description),t.hasOwnProperty("thumbnail")&&t.thumbnail.hasOwnProperty("path")&&t.thumbnail.hasOwnProperty("extension")&&(o=t.thumbnail.path+"."+t.thumbnail.extension);var l={id:i,nom:s,description:n,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(a.hasOwnProperty("data")){var r=a.data,v=0,c=null;if(r.hasOwnProperty("total")&&(v=r.total.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results))for(var c=r.results,p=[],h=null,f=null,g=null,u=null,m=null,d=0;d<c.length;d++){var y=c[d];isObject(y)&&(y.hasOwnProperty("id")&&(h=y.id.toString()),y.hasOwnProperty("title")&&(f=y.title),y.hasOwnProperty("description")&&(g=y.description),y.hasOwnProperty("images")&&(u=y.images),y.hasOwnProperty("dates")&&(m=y.dates)),p[d]={id:h,titre:f,description:g,images:u,dates:m}}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var P={infosPersonnage:l},w={nbComics:v,listeDesComics:p},O=JSON.stringify(P),b=JSON.stringify(w),D="/showCharDetails",S="POST",I={dataPersonnage:O,dataComics:b},C={page:D,methode:S,data:I,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var a=getID("cDataPersonnage");a.innerHTML=e}};new AjaxHome(C)},getListPersonnages:function(e){var a=100,r=22,t=parseInt(getID("selectLimit").value),i=parseInt(getID("pageCourante").value);i>0&&!isDefined(e)?(a=(i-1)*t,r=t):isDefined(e)&&isObject(e)&&(e.hasOwnProperty("selectFrom")&&(a=parseInt(e.selectFrom)),e.hasOwnProperty("nbByPage")&&(r=parseInt(e.nbByPage)));var s=this,n=s.PUBLIC_KEY,o=s.hash,l=s.ts,e={apikey:n,ts:l,hash:o},v={offset:a,limit:r},c=this.generateUrlParams(v),p="http://gateway.marvel.com/v1/public/characters?ts="+l+"&apikey="+n+"&hash="+o+"&"+c,h="GET",g={page:p,methode:h,callback:function(e){var t=JSON.parse(e);s.showListChars(t,r,a,i)}};new AjaxHome(g)},showListChars:function(e,a,r,t){if(e.hasOwnProperty("data")){var i=e.data,s=i.count,o=(i.offset,i.total),l=null,v=null,c=0,p=0,h=[];if(Array.isArray(i.results))for(var f=i.results,g=0;s>g;g++){var u=f[g];if(isObject(u)){var m="inconnu";u.hasOwnProperty("name")&&(m=u.name),u.hasOwnProperty("id")&&(v=u.id),u.hasOwnProperty("thumbnail")&&(l=u.thumbnail.path+"."+u.thumbnail.extension),u.hasOwnProperty("description")&&(c=sizeOf(u.description)>0?sizeOf(u.description):0),u.hasOwnProperty("comics")&&u.comics.hasOwnProperty("available")&&(p=u.comics.available.toString()),c=c.toString(),o=o.toString();var d={persID:u.id,nom:u.name,image:l,hasDesc:c,inComics:p};h[g]=d}}var y={total:o,start:r,limit:a,pageCourante:t};y=JSON.stringify(y);for(var P={},g=0;g<h.length;g++){var w=h[g];P["pers"+w.persID]=JSON.stringify(w)}P=JSON.stringify(P);var O={listePersonnages:P,donneesPagination:y},b="/getChars",D="POST",S={page:b,methode:D,data:O,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cListe");t.innerHTML=e;new Filtrages,new Selection;getID("nbParPage").value=a,getID("selectionStart").value=r}};new AjaxHome(S)}},generateUrlParams:function(e){var a="",r=sizeOf(e),t=0;for(var i in e){var s=e[i];"function"!=typeof s&&(s.toString().length>0&&"formDocument"!=i&&(a=a+i+"="+s,r-1>t&&(a+="&")),t++)}return a}};