var Personnages=function(e){var t=configKeys.public_key,i=(new Date).getTime(),r=md5(i+configKeys.private_key+configKeys.public_key),n="liste";switch(this.PUBLIC_KEY=t,this.hash=r,this.ts=i,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(n=e.mode),n){default:this.getListPersonnages();break;case"liste":this.getListPersonnages();break;case"showPers":if(e.hasOwnProperty("persID")){var s=parseInt(e.persID);this.getPersonnage(s)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var t=this,i=t.PUBLIC_KEY,r=t.hash,n=t.ts,s={offset:0,limit:100,orderBy:"onsaleDate"},l=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+n+"&apikey="+i+"&hash="+r+"&"+l,a="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+n+"&apikey="+i+"&hash="+r,c="GET",u=null,v=null,g={page:a,methode:c,callback:function(e){var i=JSON.parse(e);u=i;var r={page:o,methode:c,callback:function(e){var i=JSON.parse(e);v=i,console.log(v),t.showPersonnage(u,v)}};new AjaxHome(r)}};new AjaxHome(g)},showPersonnage:function(e,t){if(e.hasOwnProperty("data")){var i=e.data;if(i.hasOwnProperty("results")){var r=i.results[0],n=null,s=null,l="",o=null;r.hasOwnProperty("id")&&(n=r.id.toString()),r.hasOwnProperty("name")&&(s=r.name),r.hasOwnProperty("description")&&sizeOf(r.description)>0&&(l=r.description),r.hasOwnProperty("thumbnail")&&r.thumbnail.hasOwnProperty("path")&&r.thumbnail.hasOwnProperty("extension")&&(o=r.thumbnail.path+"."+r.thumbnail.extension);var a={id:n,nom:s,description:l,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(t.hasOwnProperty("data")){var i=t.data,c=0,f=null;if(i.hasOwnProperty("total")&&(c=i.total.toString()),i.hasOwnProperty("results")){if(Array.isArray(i.results))for(var f=i.results,u=[],v=null,g=null,p=null,d=null,y=null,b=0;b<f.length;b++){var h=f[b];isObject(h)&&(h.hasOwnProperty("id")&&(v=h.id.toString()),h.hasOwnProperty("title")&&(g=h.title),h.hasOwnProperty("description")&&(p=h.description),h.hasOwnProperty("images")&&(d=h.images),h.hasOwnProperty("dates")&&(y=h.dates)),u[b]={id:v,titre:g,description:p,images:d,dates:y}}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var m={infosPersonnage:a},P={nbComics:c,listeDesComics:u},O=JSON.stringify(m),D=JSON.stringify(P),F="/showCharDetails",B="POST",E={dataPersonnage:O,dataComics:D},w={page:F,methode:B,data:E,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cDataPersonnage");t.innerHTML=e}};new AjaxHome(w)},getListPersonnages:function(){var e=this,t=e.PUBLIC_KEY,i=e.hash,r=e.ts,s={offset:100,limit:22},l=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters?ts="+r+"&apikey="+t+"&hash="+i+"&"+l,a="GET",f={page:o,methode:a,callback:function(t){var i=JSON.parse(t);e.showListChars(i)}};new AjaxHome(f)},showListChars:function(e){if(e.hasOwnProperty("data")){var t=e.data,i=t.count,n=(t.offset,null),s=null,l=0,o=0,a=[];if(Array.isArray(t.results))for(var c=t.results,f=0;i>f;f++){var u=c[f];if(isObject(u)){var v="inconnu";u.hasOwnProperty("name")&&(v=u.name),u.hasOwnProperty("id")&&(s=u.id),u.hasOwnProperty("thumbnail")&&(n=u.thumbnail.path+"."+u.thumbnail.extension),u.hasOwnProperty("description")&&(l=sizeOf(u.description)>0?sizeOf(u.description):0),u.hasOwnProperty("comics")&&u.comics.hasOwnProperty("available")&&(o=u.comics.available.toString()),l=l.toString();var g={persID:u.id,nom:u.name,image:n,hasDesc:l,inComics:o};a[f]=g}}for(var p={},f=0;f<a.length;f++){var d=a[f];p["pers"+d.persID]=JSON.stringify(d)}var y=p,b="/getChars",h="POST",m={page:b,methode:h,data:y,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cListe");t.innerHTML=e;new Filtrages}};new AjaxHome(m)}},generateUrlParams:function(e){var t="",i=sizeOf(e),r=0;for(var n in e){var s=e[n];"function"!=typeof s&&(s.toString().length>0&&"formDocument"!=n&&(t=t+n+"="+s,i-1>r&&(t+="&")),r++)}return t}};