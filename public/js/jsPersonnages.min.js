var Personnages=function(a){var e=configKeys.public_key,r=(new Date).getTime(),t=md5(r+configKeys.private_key+configKeys.public_key),s="liste";switch(this.PUBLIC_KEY=e,this.hash=t,this.ts=r,isDefined(a)&&isObject(a)&&a.hasOwnProperty("mode")&&isString(a.mode)&&(s=a.mode),s){default:this.getListPersonnages();break;case"liste":this.getListPersonnages();break;case"showPers":if(a.hasOwnProperty("persID")){var i=parseInt(a.persID);this.getPersonnage(i)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(a){isDefined(a)&&isInt(a);var e=this,r=e.PUBLIC_KEY,t=e.hash,s=e.ts,i={offset:0,limit:100,orderBy:"onsaleDate"},n=this.generateUrlParams(i),o="http://gateway.marvel.com/v1/public/characters/"+a+"/comics?ts="+s+"&apikey="+r+"&hash="+t+"&"+n,l="http://gateway.marvel.com/v1/public/characters/"+a+"?ts="+s+"&apikey="+r+"&hash="+t,v="GET",h=null,p=null,f={page:l,methode:v,callback:function(a){var r=JSON.parse(a);h=r;var t={page:o,methode:v,callback:function(a){var r=JSON.parse(a);p=r,console.log(p),e.showPersonnage(h,p)}};new AjaxHome(t)}};new AjaxHome(f)},showPersonnage:function(a,e){if(a.hasOwnProperty("data")){var r=a.data;if(r.hasOwnProperty("results")){var t=r.results[0],s=null,i=null,n="",o=null;t.hasOwnProperty("id")&&(s=t.id.toString()),t.hasOwnProperty("name")&&(i=t.name),t.hasOwnProperty("description")&&sizeOf(t.description)>0&&(n=t.description),t.hasOwnProperty("thumbnail")&&t.thumbnail.hasOwnProperty("path")&&t.thumbnail.hasOwnProperty("extension")&&(o=t.thumbnail.path+"."+t.thumbnail.extension);var l={id:s,nom:i,description:n,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(e.hasOwnProperty("data")){var r=e.data,v=0,c=null;if(r.hasOwnProperty("total")&&(v=r.total.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results))for(var c=r.results,h=[],p=null,f=null,u=null,g=null,d=null,m=0;m<c.length;m++){var y=c[m];isObject(y)&&(y.hasOwnProperty("id")&&(p=y.id.toString()),y.hasOwnProperty("title")&&(f=y.title),y.hasOwnProperty("description")&&(u=y.description),y.hasOwnProperty("images")&&(g=y.images),y.hasOwnProperty("dates")&&(d=y.dates)),h[m]={id:p,titre:f,description:u,images:g,dates:d}}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var w={infosPersonnage:l},P={nbComics:v,listeDesComics:h},O=JSON.stringify(w),b=JSON.stringify(P),k="/showCharDetails",D="POST",A={dataPersonnage:O,dataComics:b},C={page:k,methode:D,data:A,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(a){var e=getID("cDataPersonnage");e.innerHTML=a}};new AjaxHome(C)},getListPersonnages:function(){var a=this,e=a.PUBLIC_KEY,r=a.hash,t=a.ts,i={offset:100,limit:22},n=this.generateUrlParams(i),o="http://gateway.marvel.com/v1/public/characters?ts="+t+"&apikey="+e+"&hash="+r+"&"+n,l="GET",c={page:o,methode:l,callback:function(e){var r=JSON.parse(e);a.showListChars(r)}};new AjaxHome(c)},showListChars:function(a){if(a.hasOwnProperty("data")){var e=a.data,r=e.count,s=(e.offset,null),i=null,n=0,o=[];if(Array.isArray(e.results))for(var l=e.results,v=0;r>v;v++){var c=l[v];if(isObject(c)){var h="inconnu";c.hasOwnProperty("name")&&(h=c.name),c.hasOwnProperty("id")&&(i=c.id),c.hasOwnProperty("thumbnail")&&(s=c.thumbnail.path+"."+c.thumbnail.extension),c.hasOwnProperty("description")&&(n=sizeOf(c.description)>0?sizeOf(c.description):0),n=n.toString();var p={persID:c.id,nom:c.name,image:s,hasDesc:n};o[v]=p}}for(var f={},v=0;v<o.length;v++){var u=o[v];f["pers"+u.persID]=JSON.stringify(u)}var g=f,d="/getChars",m="POST",y={page:d,methode:m,data:g,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(a){var e=getID("cListe");e.innerHTML=a}};new AjaxHome(y)}},generateUrlParams:function(a){var e="",r=sizeOf(a),t=0;for(var s in a){var i=a[s];"function"!=typeof i&&(i.toString().length>0&&"formDocument"!=s&&(e=e+s+"="+i,r-1>t&&(e+="&")),t++)}return e}};