var Personnages=function(e){var a=configKeys.public_key,r=(new Date).getTime(),t=md5(r+configKeys.private_key+configKeys.public_key),s="liste";switch(this.PUBLIC_KEY=a,this.hash=t,this.ts=r,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(s=e.mode),s){default:this.getListPersonnages();break;case"liste":if(isDefined(e)&&e.hasOwnProperty("paramsListe"))var i=e.paramsListe;else var i=void 0;this.getListPersonnages(i);break;case"showPers":if(e.hasOwnProperty("persID")){var n=parseInt(e.persID);this.getPersonnage(n)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var a=this,r=a.PUBLIC_KEY,t=a.hash,s=a.ts,i={offset:0,orderBy:"onsaleDate%2CissueNumber"},n=this.generateUrlParams(i),o="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+s+"&apikey="+r+"&hash="+t+"&"+n,l="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+s+"&apikey="+r+"&hash="+t,d="GET",h=null,c=null,f={page:l,methode:d,callback:function(e){var r=JSON.parse(e);h=r;var t={page:o,methode:d,callback:function(e){var r=JSON.parse(e);c=r,a.showPersonnage(h,c)},withLoader:function(){var e=getID("cDataPersonnage");if(BlocPresent("cLoader_getPersonnage"))var a=getID("cLoader_getPersonnage");else{var a=document.createElement("div");a.id="cLoader_getPersonnage",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(t)}};new AjaxHome(f)},showPersonnage:function(e,a){if(e.hasOwnProperty("data")){var r=e.data;if(r.hasOwnProperty("results")){var t=r.results[0],s=null,i=null,n="",o=null;t.hasOwnProperty("id")&&(s=t.id.toString()),t.hasOwnProperty("name")&&(i=t.name),t.hasOwnProperty("description")&&sizeOf(t.description)>0&&(n=t.description),t.hasOwnProperty("thumbnail")&&t.thumbnail.hasOwnProperty("path")&&t.thumbnail.hasOwnProperty("extension")&&(o=t.thumbnail.path+"."+t.thumbnail.extension);var l={id:s,nom:i,description:n,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(a.hasOwnProperty("data")){var r=a.data,d=0,v=null;if(r.hasOwnProperty("total")&&(d=r.total.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results)){for(var v=r.results,h=[],c=null,f=null,p=null,g=null,u=null,m=0;m<v.length;m++){var P=v[m];isObject(P)&&P.digitalId>0&&(P.hasOwnProperty("id")&&(c=P.id.toString()),P.hasOwnProperty("title")&&(f=P.title),P.hasOwnProperty("description")&&(p=P.description),P.hasOwnProperty("images")&&(g=P.images),P.hasOwnProperty("dates")&&(u=P.dates),h[m]={id:c,titre:f,description:p,images:g[0],dates:u})}h.clean()}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var w={infosPersonnage:l},y={nbComics:d,listeDesComics:h},O=JSON.stringify(w),b=JSON.stringify(y),L="/showCharDetails",C="POST",D={dataPersonnage:O,dataComics:b},I={page:L,methode:C,data:D,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var a=getID("cDataPersonnage");a.innerHTML=e},withLoader:function(){var e=getID("cDataPersonnage");if(!BlocPresent("cLoader_personnage")){var a=document.createElement("div");a.id="cLoader_personnage",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(I)},getListPersonnages:function(e){var a=100,r=22,t=parseInt(getID("selectLimit").value),s=parseInt(getID("pageCourante").value);s>0&&!isDefined(e)?(a=(s-1)*t,r=t):isDefined(e)&&isObject(e)&&(e.hasOwnProperty("selectFrom")&&(a=parseInt(e.selectFrom)),e.hasOwnProperty("nbByPage")&&(r=parseInt(e.nbByPage)));var i=this,n=i.PUBLIC_KEY,o=i.hash,l=i.ts,e={apikey:n,ts:l,hash:o},d={offset:a,limit:r},v=this.generateUrlParams(d),h="http://gateway.marvel.com/v1/public/characters?ts="+l+"&apikey="+n+"&hash="+o+"&"+v,c="GET",p={page:h,methode:c,callback:function(e){var t=JSON.parse(e);i.showListChars(t,r,a,s)},withLoader:function(){var e=getID("cListe");if(!BlocPresent("cLoader_listePersonnages")){var a=document.createElement("div");a.id="cLoader_listePersonnages",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(p)},showListChars:function(e,a,r,t){if(e.hasOwnProperty("data")){var s=e.data,i=s.count,o=(s.offset,s.total),l=null,d=null,v=0,h=0,c=[];if(Array.isArray(s.results))for(var f=s.results,p=0;i>p;p++){var g=f[p];if(isObject(g)){var u="inconnu";g.hasOwnProperty("name")&&(u=g.name),g.hasOwnProperty("id")&&(d=g.id),g.hasOwnProperty("thumbnail")&&(l=g.thumbnail.path+"."+g.thumbnail.extension),g.hasOwnProperty("description")&&(v=sizeOf(g.description)>0?sizeOf(g.description):0),g.hasOwnProperty("comics")&&g.comics.hasOwnProperty("available")&&(h=g.comics.available.toString()),v=v.toString(),o=o.toString();var m={persID:g.id,nom:g.name,image:l,hasDesc:v,inComics:h};c[p]=m}}var P={total:o,start:r,limit:a,pageCourante:t};P=JSON.stringify(P);for(var w={},p=0;p<c.length;p++){var y=c[p];w["pers"+y.persID]=JSON.stringify(y)}w=JSON.stringify(w);var O={listePersonnages:w,donneesPagination:P},b="/getChars",L="POST",C={page:b,methode:L,data:O,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cListe");t.innerHTML=e;new Filtrages,new Selection;getID("nbParPage").value=a,getID("selectionStart").value=r},withLoader:function(){var e=getID("cListe");if(!BlocPresent("cLoader_showListePersonnages")){var a=document.createElement("div");a.id="cLoader_showListePersonnages",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(C)}},generateUrlParams:function(e){var a="",r=sizeOf(e),t=0;for(var s in e){var i=e[s];"function"!=typeof i&&(i.toString().length>0&&"formDocument"!=s&&(a=a+s+"="+i,r-1>t&&(a+="&")),t++)}return a}};