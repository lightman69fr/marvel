var Personnages=function(e){var a=configKeys.public_key,r=(new Date).getTime(),t=md5(r+configKeys.private_key+configKeys.public_key),n="liste";switch(this.PUBLIC_KEY=a,this.hash=t,this.ts=r,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(n=e.mode),n){default:this.getListPersonnages();break;case"liste":this.getListPersonnages();break;case"showPers":if(e.hasOwnProperty("persID")){var s=parseInt(e.persID);this.getPersonnage(s)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var a=this,r=a.PUBLIC_KEY,t=a.hash,n=a.ts,s={offset:0,limit:100,orderBy:"onsaleDate"},i=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+n+"&apikey="+r+"&hash="+t+"&"+i,l="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+n+"&apikey="+r+"&hash="+t,v="GET",f=null,h=null,p={page:l,methode:v,callback:function(e){var r=JSON.parse(e);f=r;var t={page:o,methode:v,callback:function(e){var r=JSON.parse(e);h=r,a.showPersonnage(f,h)}};new AjaxHome(t)}};new AjaxHome(p)},showPersonnage:function(e,a){if(e.hasOwnProperty("data")){var r=e.data;if(r.hasOwnProperty("results")){var t=r.results[0],n=null,s=null,i="",o=null;t.hasOwnProperty("id")&&(n=t.id.toString()),t.hasOwnProperty("name")&&(s=t.name),t.hasOwnProperty("description")&&sizeOf(t.description)>0&&(i=t.description),t.hasOwnProperty("thumbnail")&&t.thumbnail.hasOwnProperty("path")&&t.thumbnail.hasOwnProperty("extension")&&(o=t.thumbnail.path+"."+t.thumbnail.extension);var l={id:n,nom:s,description:i,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(a.hasOwnProperty("data")){var r=a.data,v=0,c=null;if(r.hasOwnProperty("count")&&(v=r.count.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results))for(var c=r.results,f=[],h=null,p=null,u=null,d=null,m=null,g=0;g<c.length;g++){var w=c[g];isObject(w)&&(w.hasOwnProperty("id")&&(h=w.id.toString()),w.hasOwnProperty("title")&&(p=w.title),w.hasOwnProperty("description")&&(u=w.description),w.hasOwnProperty("images")&&(d=w.images),w.hasOwnProperty("dates")&&(m=w.dates)),f[g]={id:h,titre:p,description:u,images:d,dates:m}}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var y={infosPersonnage:l},P={nbComics:v,listeDesComics:f},O=JSON.stringify(y),b=JSON.stringify(P),A="/showCharDetails",D="POST",k={dataPersonnage:O,dataComics:b},S={page:A,methode:D,data:k,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var a=getID("cDataPersonnage");a.innerHTML=e}};new AjaxHome(S)},getListPersonnages:function(){var e=this,a=e.PUBLIC_KEY,r=e.hash,t=e.ts,s={offset:0,limit:100},i=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters?ts="+t+"&apikey="+a+"&hash="+r+"&"+i,l="GET",c={page:o,methode:l,callback:function(a){var r=JSON.parse(a);e.showListChars(r)}};new AjaxHome(c)},showListChars:function(e){if(e.hasOwnProperty("data")){var a=e.data,r=a.count,n=(a.offset,null),s=null,i=0,o=[];if(Array.isArray(a.results))for(var l=a.results,v=0;r>v;v++){var c=l[v];if(isObject(c)){var f="inconnu";c.hasOwnProperty("name")&&(f=c.name),c.hasOwnProperty("id")&&(s=c.id),c.hasOwnProperty("thumbnail")&&(n=c.thumbnail.path+"."+c.thumbnail.extension),c.hasOwnProperty("description")&&(i=sizeOf(c.description)>0?sizeOf(c.description):0),i=i.toString();var h={persID:c.id,nom:c.name,image:n,hasDesc:i};o[v]=h}}for(var p={},v=0;v<o.length;v++){var u=o[v];p["pers"+u.persID]=JSON.stringify(u)}var d=p,m="/getChars",g="POST",w={page:m,methode:g,data:d,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var a=getID("cListe");a.innerHTML=e}};new AjaxHome(w)}},generateUrlParams:function(e){var a="",r=sizeOf(e),t=0;for(var n in e){var s=e[n];"function"!=typeof s&&(s.toString().length>0&&"formDocument"!=n&&(a=a+n+"="+s,r-1>t&&(a+="&")),t++)}return a}};