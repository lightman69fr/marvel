var Personnages=function(e){var a=configKeys.public_key,r=(new Date).getTime(),t=md5(r+configKeys.private_key+configKeys.public_key),i="liste";switch(this.PUBLIC_KEY=a,this.hash=t,this.ts=r,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(i=e.mode),i){default:this.getListPersonnages();break;case"liste":if(isDefined(e)&&e.hasOwnProperty("paramsListe"))var s=e.paramsListe;else var s=void 0;this.getListPersonnages(s);break;case"showPers":if(e.hasOwnProperty("persID")){var n=parseInt(e.persID);this.getPersonnage(n)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var a=this,r=a.PUBLIC_KEY,t=a.hash,i=a.ts,s={offset:0,orderBy:"onsaleDate%2CissueNumber"},n=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+i+"&apikey="+r+"&hash="+t+"&"+n,l="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+i+"&apikey="+r+"&hash="+t,v="GET",c=null,h=null,f={page:l,methode:v,callback:function(e){var r=JSON.parse(e);c=r;var t={page:o,methode:v,callback:function(e){var r=JSON.parse(e);h=r,a.showPersonnage(c,h)},withLoader:function(){var e=getID("cDataPersonnage");if(BlocPresent("cLoader_getPersonnage"))var a=getID("cLoader_getPersonnage");else{var a=document.createElement("div");a.id="cLoader_getPersonnage",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(t)}};new AjaxHome(f)},showPersonnage:function(e,a){if(e.hasOwnProperty("data")){var r=e.data;if(r.hasOwnProperty("results")){var t=r.results[0],i=null,s=null,n="",o=null;t.hasOwnProperty("id")&&(i=t.id.toString()),t.hasOwnProperty("name")&&(s=t.name),t.hasOwnProperty("description")&&sizeOf(t.description)>0&&(n=t.description),t.hasOwnProperty("thumbnail")&&t.thumbnail.hasOwnProperty("path")&&t.thumbnail.hasOwnProperty("extension")&&(o=t.thumbnail.path+"."+t.thumbnail.extension);var l={id:i,nom:s,description:n,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(a.hasOwnProperty("data")){var r=a.data,v=0,d=null;if(r.hasOwnProperty("total")&&(v=r.total.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results)){for(var d=r.results,c=[],h=null,f=null,p=null,g=null,u=null,m=0;m<d.length;m++){var P=d[m];isObject(P)&&P.digitalId>0&&(P.hasOwnProperty("id")&&(h=P.id.toString()),P.hasOwnProperty("title")&&(f=P.title),P.hasOwnProperty("description")&&(p=P.description),P.hasOwnProperty("images")&&(g=P.images),P.hasOwnProperty("dates")&&(u=P.dates),c[m]={id:h,titre:f,description:p,images:g[0],dates:u})}c.clean()}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var w={infosPersonnage:l},y={nbComics:v,listeDesComics:c},O=JSON.stringify(w),b=JSON.stringify(y),L="/showCharDetails",C="POST",D={dataPersonnage:O,dataComics:b},I={page:L,methode:C,data:D,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var a=getID("cDataPersonnage");a.innerHTML=e},withLoader:function(){var e=getID("cDataPersonnage");if(BlocPresent("cLoader_personnage"))var a=getID("cLoader_personnage");else{var a=document.createElement("div");a.id="cLoader_personnage",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(I)},getListPersonnages:function(e){var a=100,r=22,t=parseInt(getID("selectLimit").value),i=parseInt(getID("pageCourante").value);i>0&&!isDefined(e)?(a=(i-1)*t,r=t):isDefined(e)&&isObject(e)&&(e.hasOwnProperty("selectFrom")&&(a=parseInt(e.selectFrom)),e.hasOwnProperty("nbByPage")&&(r=parseInt(e.nbByPage)));var s=this,n=s.PUBLIC_KEY,o=s.hash,l=s.ts,e={apikey:n,ts:l,hash:o},v={offset:a,limit:r},d=this.generateUrlParams(v),c="http://gateway.marvel.com/v1/public/characters?ts="+l+"&apikey="+n+"&hash="+o+"&"+d,h="GET",p={page:c,methode:h,callback:function(e){var t=JSON.parse(e);s.showListChars(t,r,a,i)},withLoader:function(){var e=getID("cListe");if(!BlocPresent("cLoader_listePersonnages")){var a=document.createElement("div");a.id="cLoader_listePersonnages",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(p)},showListChars:function(e,a,r,t){if(e.hasOwnProperty("data")){var i=e.data,s=i.count,o=(i.offset,i.total),l=null,v=null,d=0,c=0,h=[];if(Array.isArray(i.results))for(var f=i.results,p=0;s>p;p++){var g=f[p];if(isObject(g)){var u="inconnu";g.hasOwnProperty("name")&&(u=g.name),g.hasOwnProperty("id")&&(v=g.id),g.hasOwnProperty("thumbnail")&&(l=g.thumbnail.path+"."+g.thumbnail.extension),g.hasOwnProperty("description")&&(d=sizeOf(g.description)>0?sizeOf(g.description):0),g.hasOwnProperty("comics")&&g.comics.hasOwnProperty("available")&&(c=g.comics.available.toString()),d=d.toString(),o=o.toString();var m={persID:g.id,nom:g.name,image:l,hasDesc:d,inComics:c};h[p]=m}}var P={total:o,start:r,limit:a,pageCourante:t};P=JSON.stringify(P);for(var w={},p=0;p<h.length;p++){var y=h[p];w["pers"+y.persID]=JSON.stringify(y)}w=JSON.stringify(w);var O={listePersonnages:w,donneesPagination:P},b="/getChars",L="POST",C={page:b,methode:L,data:O,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cListe");t.innerHTML=e;new Filtrages,new Selection;getID("nbParPage").value=a,getID("selectionStart").value=r},withLoader:function(){var e=getID("cListe");if(!BlocPresent("cLoader_showListePersonnages")){var a=document.createElement("div");a.id="cLoader_showListePersonnages",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(C)}},generateUrlParams:function(e){var a="",r=sizeOf(e),t=0;for(var i in e){var s=e[i];"function"!=typeof s&&(s.toString().length>0&&"formDocument"!=i&&(a=a+i+"="+s,r-1>t&&(a+="&")),t++)}return a}};