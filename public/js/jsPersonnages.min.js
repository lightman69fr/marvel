var Personnages=function(e){var a=configKeys.public_key,r=(new Date).getTime(),t=md5(r+configKeys.private_key+configKeys.public_key),i="liste";switch(this.PUBLIC_KEY=a,this.hash=t,this.ts=r,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(i=e.mode),i){default:this.getListPersonnages();break;case"liste":if(isDefined(e)&&e.hasOwnProperty("paramsListe"))var s=e.paramsListe;else var s=void 0;this.getListPersonnages(s);break;case"showPers":if(e.hasOwnProperty("persID")){var n=parseInt(e.persID);this.getPersonnage(n)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var a=this,r=a.PUBLIC_KEY,t=a.hash,i=a.ts,s={offset:0,limit:100,orderBy:"onsaleDate"},n=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+i+"&apikey="+r+"&hash="+t+"&"+n,l="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+i+"&apikey="+r+"&hash="+t,v="GET",p=null,h=null,f={page:l,methode:v,callback:function(e){var r=JSON.parse(e);p=r;var t={page:o,methode:v,callback:function(e){var r=JSON.parse(e);h=r,console.log(h),a.showPersonnage(p,h)}};new AjaxHome(t)}};new AjaxHome(f)},showPersonnage:function(e,a){if(e.hasOwnProperty("data")){var r=e.data;if(r.hasOwnProperty("results")){var t=r.results[0],i=null,s=null,n="",o=null;t.hasOwnProperty("id")&&(i=t.id.toString()),t.hasOwnProperty("name")&&(s=t.name),t.hasOwnProperty("description")&&sizeOf(t.description)>0&&(n=t.description),t.hasOwnProperty("thumbnail")&&t.thumbnail.hasOwnProperty("path")&&t.thumbnail.hasOwnProperty("extension")&&(o=t.thumbnail.path+"."+t.thumbnail.extension);var l={id:i,nom:s,description:n,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(a.hasOwnProperty("data")){var r=a.data,v=0,c=null;if(r.hasOwnProperty("total")&&(v=r.total.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results))for(var c=r.results,p=[],h=null,f=null,g=null,u=null,m=null,d=0;d<c.length;d++){var P=c[d];isObject(P)&&(P.hasOwnProperty("id")&&(h=P.id.toString()),P.hasOwnProperty("title")&&(f=P.title),P.hasOwnProperty("description")&&(g=P.description),P.hasOwnProperty("images")&&(u=P.images),P.hasOwnProperty("dates")&&(m=P.dates)),p[d]={id:h,titre:f,description:g,images:u,dates:m}}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var y={infosPersonnage:l},w={nbComics:v,listeDesComics:p},O=JSON.stringify(y),b=JSON.stringify(w),S="/showCharDetails",D="POST",I={dataPersonnage:O,dataComics:b},k={page:S,methode:D,data:I,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var a=getID("cDataPersonnage");a.innerHTML=e}};new AjaxHome(k)},getListPersonnages:function(e){var a=100,r=22;isDefined(e)&&isObject(e)&&(e.hasOwnProperty("selectFrom")&&(a=parseInt(e.selectFrom)),e.hasOwnProperty("nbByPage")&&(r=parseInt(e.nbByPage)));var t=this,i=t.PUBLIC_KEY,s=t.hash,n=t.ts,e={apikey:i,ts:n,hash:s},o={offset:a,limit:r},l=this.generateUrlParams(o),v="http://gateway.marvel.com/v1/public/characters?ts="+n+"&apikey="+i+"&hash="+s+"&"+l,c="GET",h={page:v,methode:c,callback:function(e){var i=JSON.parse(e);t.showListChars(i,r,a)}};new AjaxHome(h)},showListChars:function(e,a,r){if(e.hasOwnProperty("data")){var t=e.data,i=t.count,n=(t.offset,null),o=null,l=0,v=0,c=[];if(Array.isArray(t.results))for(var p=t.results,h=0;i>h;h++){var f=p[h];if(isObject(f)){var g="inconnu";f.hasOwnProperty("name")&&(g=f.name),f.hasOwnProperty("id")&&(o=f.id),f.hasOwnProperty("thumbnail")&&(n=f.thumbnail.path+"."+f.thumbnail.extension),f.hasOwnProperty("description")&&(l=sizeOf(f.description)>0?sizeOf(f.description):0),f.hasOwnProperty("comics")&&f.comics.hasOwnProperty("available")&&(v=f.comics.available.toString()),l=l.toString();var u={persID:f.id,nom:f.name,image:n,hasDesc:l,inComics:v};c[h]=u}}for(var m={},h=0;h<c.length;h++){var d=c[h];m["pers"+d.persID]=JSON.stringify(d)}var P=m,y="/getChars",w="POST",O={page:y,methode:w,data:P,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cListe");t.innerHTML=e;new Filtrages,new Selection;getID("nbParPage").value=a,getID("selectionStart").value=r}};new AjaxHome(O)}},generateUrlParams:function(e){var a="",r=sizeOf(e),t=0;for(var i in e){var s=e[i];"function"!=typeof s&&(s.toString().length>0&&"formDocument"!=i&&(a=a+i+"="+s,r-1>t&&(a+="&")),t++)}return a}};