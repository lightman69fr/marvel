var Personnages=function(e){var t=configKeys.public_key,r=(new Date).getTime(),s=md5(r+configKeys.private_key+configKeys.public_key),i="liste";switch(this.PUBLIC_KEY=t,this.hash=s,this.ts=r,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(i=e.mode),i){default:this.getListPersonnages();break;case"liste":this.getListPersonnages();break;case"showPers":if(e.hasOwnProperty("persID")){var a=parseInt(e.persID);this.getPersonnage(a)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var t=this,r=t.PUBLIC_KEY,s=t.hash,i=t.ts,a={offset:0,limit:100,orderBy:"onsaleDate"},o=this.generateUrlParams(a),l="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+i+"&apikey="+r+"&hash="+s+"&"+o,n="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+i+"&apikey="+r+"&hash="+s,c="GET",u=null,g=null,v={page:n,methode:c,callback:function(e){var r=JSON.parse(e);u=r;var s={page:l,methode:c,callback:function(e){var r=JSON.parse(e);g=r,console.log(g),t.showPersonnage(u,g)}};new AjaxHome(s)}};new AjaxHome(v)},showPersonnage:function(e,t){if(e.hasOwnProperty("data")){var r=e.data;if(r.hasOwnProperty("results")){var s=r.results[0],i=null,a=null,o="",l=null;s.hasOwnProperty("id")&&(i=s.id.toString()),s.hasOwnProperty("name")&&(a=s.name),s.hasOwnProperty("description")&&sizeOf(s.description)>0&&(o=s.description),s.hasOwnProperty("thumbnail")&&s.thumbnail.hasOwnProperty("path")&&s.thumbnail.hasOwnProperty("extension")&&(l=s.thumbnail.path+"."+s.thumbnail.extension);var n={id:i,nom:a,description:o,image:l}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(t.hasOwnProperty("data")){var r=t.data,c=0,f=null;if(r.hasOwnProperty("total")&&(c=r.total.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results))for(var f=r.results,u=[],g=null,v=null,d=null,p=null,h=null,b=0;b<f.length;b++){var y=f[b];isObject(y)&&(y.hasOwnProperty("id")&&(g=y.id.toString()),y.hasOwnProperty("title")&&(v=y.title),y.hasOwnProperty("description")&&(d=y.description),y.hasOwnProperty("images")&&(p=y.images),y.hasOwnProperty("dates")&&(h=y.dates)),u[b]={id:g,titre:v,description:d,images:p,dates:h}}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var m={infosPersonnage:n},P={nbComics:c,listeDesComics:u},k=JSON.stringify(m),A=JSON.stringify(P),D="/showCharDetails",w="POST",F={dataPersonnage:k,dataComics:A},I={page:D,methode:w,data:F,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cDataPersonnage");t.innerHTML=e}};new AjaxHome(I)},getListPersonnages:function(){var e=this,t=e.PUBLIC_KEY,r=e.hash,s=e.ts,a={offset:100,limit:22},o=this.generateUrlParams(a),l="http://gateway.marvel.com/v1/public/characters?ts="+s+"&apikey="+t+"&hash="+r+"&"+o,n="GET",f={page:l,methode:n,callback:function(t){var r=JSON.parse(t);e.showListChars(r)}};new AjaxHome(f)},showListChars:function(e){if(e.hasOwnProperty("data")){var t=e.data,r=t.count,i=(t.offset,null),a=null,o=0,l=0,n=[];if(Array.isArray(t.results))for(var c=t.results,f=0;r>f;f++){var u=c[f];if(isObject(u)){var g="inconnu";u.hasOwnProperty("name")&&(g=u.name),u.hasOwnProperty("id")&&(a=u.id),u.hasOwnProperty("thumbnail")&&(i=u.thumbnail.path+"."+u.thumbnail.extension),u.hasOwnProperty("description")&&(o=sizeOf(u.description)>0?sizeOf(u.description):0),u.hasOwnProperty("comics")&&u.comics.hasOwnProperty("available")&&(l=u.comics.available.toString()),o=o.toString();var v={persID:u.id,nom:u.name,image:i,hasDesc:o,inComics:l};n[f]=v}}for(var d={},f=0;f<n.length;f++){var p=n[f];d["pers"+p.persID]=JSON.stringify(p)}var h=d,b="/getChars",y="POST",m={page:b,methode:y,data:h,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cListe");t.innerHTML=e;new Filtrages}};new AjaxHome(m)}},generateUrlParams:function(e){var t="",r=sizeOf(e),s=0;for(var i in e){var a=e[i];"function"!=typeof a&&(a.toString().length>0&&"formDocument"!=i&&(t=t+i+"="+a,r-1>s&&(t+="&")),s++)}return t}};