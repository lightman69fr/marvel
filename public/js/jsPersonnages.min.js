var Personnages=function(e){var a=configKeys.public_key,r=(new Date).getTime(),t=md5(r+configKeys.private_key+configKeys.public_key),i="liste";switch(this.PUBLIC_KEY=a,this.hash=t,this.ts=r,isDefined(e)&&isObject(e)&&e.hasOwnProperty("mode")&&isString(e.mode)&&(i=e.mode),i){default:this.getListPersonnages();break;case"liste":if(isDefined(e)&&e.hasOwnProperty("paramsListe"))var s=e.paramsListe;else var s=void 0;this.getListPersonnages(s);break;case"showPers":if(e.hasOwnProperty("persID")){var n=parseInt(e.persID);this.getPersonnage(n)}else alert("Aucun id de persnnage fourni")}};Personnages.prototype={getPersonnage:function(e){isDefined(e)&&isInt(e);var a=this,r=a.PUBLIC_KEY,t=a.hash,i=a.ts,s={offset:0,orderBy:"onsaleDate%2CissueNumber"},n=this.generateUrlParams(s),o="http://gateway.marvel.com/v1/public/characters/"+e+"/comics?ts="+i+"&apikey="+r+"&hash="+t+"&"+n,l="http://gateway.marvel.com/v1/public/characters/"+e+"?ts="+i+"&apikey="+r+"&hash="+t,v="GET",p=null,f=null,h={page:l,methode:v,callback:function(e){var r=JSON.parse(e);p=r;var t={page:o,methode:v,callback:function(e){var r=JSON.parse(e);f=r,a.showPersonnage(p,f)},withLoader:function(){var e=getID("cDataPersonnage");if(!BlocPresent("cLoader_getPersonnage")){var a=document.createElement("div");a.id="cLoader_getPersonnage",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(t)}};new AjaxHome(h)},showPersonnage:function(e,a){if(e.hasOwnProperty("data")){var r=e.data;if(r.hasOwnProperty("results")){var t=r.results[0],i=null,s=null,n="",o=null;t.hasOwnProperty("id")&&(i=t.id.toString()),t.hasOwnProperty("name")&&(s=t.name),t.hasOwnProperty("description")&&sizeOf(t.description)>0&&(n=t.description),t.hasOwnProperty("thumbnail")&&t.thumbnail.hasOwnProperty("path")&&t.thumbnail.hasOwnProperty("extension")&&(o=t.thumbnail.path+"."+t.thumbnail.extension);var l={id:i,nom:s,description:n,image:o}}else console.log("impossible de récupérer les données du personnage")}else console.log("aucune donnée disponible pour ce personnage");if(a.hasOwnProperty("data")){var r=a.data,v=0,c=null;if(r.hasOwnProperty("total")&&(v=r.total.toString()),r.hasOwnProperty("results")){if(Array.isArray(r.results)){for(var c=r.results,p=[],f=null,h=null,g=null,d=null,u=null,m=0;m<c.length;m++){var y=c[m];isObject(y)&&y.digitalId>0&&(y.hasOwnProperty("id")&&(f=y.id.toString()),y.hasOwnProperty("title")&&(h=y.title),y.hasOwnProperty("description")&&(g=y.description),y.hasOwnProperty("images")&&(d=y.images),y.hasOwnProperty("dates")&&(u=y.dates),p[m]={id:f,titre:h,description:g,images:d[0],dates:u})}p.clean()}}else console.log("impossible de récupérer la liste des comics pour ce personnage")}var P={infosPersonnage:l},w={nbComics:v,listeDesComics:p},O=JSON.stringify(P),b=JSON.stringify(w),D="/showCharDetails",S="POST",I={dataPersonnage:O,dataComics:b},C={page:D,methode:S,data:I,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var a=getID("cDataPersonnage");a.innerHTML=e},withLoader:function(){var e=getID("cDataPersonnage");if(!BlocPresent("cLoader_personnage")){var a=document.createElement("div");a.id="cLoader_personnage",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(C)},getListPersonnages:function(e){var a=100,r=22,t=parseInt(getID("selectLimit").value),i=parseInt(getID("pageCourante").value);i>0&&!isDefined(e)?(a=(i-1)*t,r=t):isDefined(e)&&isObject(e)&&(e.hasOwnProperty("selectFrom")&&(a=parseInt(e.selectFrom)),e.hasOwnProperty("nbByPage")&&(r=parseInt(e.nbByPage)));var s=this,n=s.PUBLIC_KEY,o=s.hash,l=s.ts,e={apikey:n,ts:l,hash:o},v={offset:a,limit:r},c=this.generateUrlParams(v),p="http://gateway.marvel.com/v1/public/characters?ts="+l+"&apikey="+n+"&hash="+o+"&"+c,f="GET",g={page:p,methode:f,callback:function(e){var t=JSON.parse(e);s.showListChars(t,r,a,i)},withLoader:function(){var e=getID("cListe");if(!BlocPresent("cLoader_listePersonnages")){var a=document.createElement("div");a.id="cLoader_listePersonnages",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(g)},showListChars:function(e,a,r,t){if(e.hasOwnProperty("data")){var i=e.data,s=i.count,o=(i.offset,i.total),l=null,v=null,c=0,p=0,f=[];if(Array.isArray(i.results))for(var h=i.results,g=0;s>g;g++){var d=h[g];if(isObject(d)){var u="inconnu";d.hasOwnProperty("name")&&(u=d.name),d.hasOwnProperty("id")&&(v=d.id),d.hasOwnProperty("thumbnail")&&(l=d.thumbnail.path+"."+d.thumbnail.extension),d.hasOwnProperty("description")&&(c=sizeOf(d.description)>0?sizeOf(d.description):0),d.hasOwnProperty("comics")&&d.comics.hasOwnProperty("available")&&(p=d.comics.available.toString()),c=c.toString(),o=o.toString();var m={persID:d.id,nom:d.name,image:l,hasDesc:c,inComics:p};f[g]=m}}var y={total:o,start:r,limit:a,pageCourante:t};y=JSON.stringify(y);for(var P={},g=0;g<f.length;g++){var w=f[g];P["pers"+w.persID]=JSON.stringify(w)}P=JSON.stringify(P);var O={listePersonnages:P,donneesPagination:y},b="/getChars",D="POST",S={page:b,methode:D,data:O,headers:[{titre:"Content-type",valeur:"application/x-www-form-urlencoded"}],callback:function(e){var t=getID("cListe");t.innerHTML=e;new Filtrages,new Selection;getID("nbParPage").value=a,getID("selectionStart").value=r},withLoader:function(){var e=getID("cListe");if(!BlocPresent("cLoader_showListePersonnages")){var a=document.createElement("div");a.id="cLoader_showListePersonnages",a.addClass("loader"),e.appendChild(a)}a.innerHTML="<div><div>Chargement des données</div></div>"}};new AjaxHome(S)}},generateUrlParams:function(e){var a="",r=sizeOf(e),t=0;for(var i in e){var s=e[i];"function"!=typeof s&&(s.toString().length>0&&"formDocument"!=i&&(a=a+i+"="+s,r-1>t&&(a+="&")),t++)}return a}};